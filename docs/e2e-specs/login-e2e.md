# ログイン画面 E2Eテスト仕様書

生成日: 2026-02-06
対象ページ: `/login` (U-001)
権限レベル: 未認証（Public）

---

## ユーザーゴール

1. メールアドレスとパスワードで社内FAQシステムに安全にログインできる
2. ログイン後、チャット画面にリダイレクトされる
3. デモアカウントで簡単にシステムを試せる
4. 認証エラーが明確に表示される

---

## テスト環境

```yaml
URL: http://localhost:3247/login
認証: 不要（未認証ページ）
テストアカウント:
  管理者:
    email: admin@example.com
    password: admin123
  一般ユーザー:
    email: demo@example.com
    password: demo123
```

---

## E2Eテスト項目一覧（5項目）

| ID | テスト項目 | フロー内容 | 期待結果 |
|----|----------|-----------|---------|
| E2E-LOGIN-001 | ページアクセス・表示 | /login アクセス → ログインフォーム表示 | メールアドレス、パスワード入力欄、ログインボタン、デモアカウント情報が表示される |
| E2E-LOGIN-002 | 管理者アカウントでログイン | 管理者メール・パスワード入力 → ログインボタンクリック → リダイレクト | チャット画面（/）に遷移し、認証済み状態になる |
| E2E-LOGIN-003 | 一般ユーザーアカウントでログイン | 一般ユーザーメール・パスワード入力 → ログインボタンクリック → リダイレクト | チャット画面（/）に遷移し、認証済み状態になる |
| E2E-LOGIN-004 | 誤った認証情報でログイン試行 | 間違ったメール/パスワード入力 → ログインボタンクリック → エラー表示 | エラーメッセージ（Alert）が表示され、ログインページに留まる |
| E2E-LOGIN-005 | ログイン中の状態表示 | ログインボタンクリック → ボタンが無効化 | ボタンテキストが「ログイン中...」に変わり、ボタンが無効化される |

---

## 詳細フロー

### E2E-LOGIN-001: ページアクセス・表示

**目的**: ログインページが正しく表示されることを確認

**操作手順**:
1. ブラウザで http://localhost:3247/login にアクセス

**期待結果**:
- ✅ ページタイトル「ログイン」が表示される
- ✅ メールアドレス入力欄が表示される
- ✅ パスワード入力欄が表示される
- ✅ 「ログイン」ボタンが表示される
- ✅ 「Okta SSOでログイン」ボタンが表示される（無効状態）
- ✅ デモアカウント情報（管理者・一般ユーザー）が表示される

---

### E2E-LOGIN-002: 管理者アカウントでログイン

**目的**: 管理者アカウントでログインし、チャット画面にアクセスできることを確認

**操作手順**:
1. http://localhost:3247/login にアクセス
2. メールアドレス欄に `admin@example.com` を入力
3. パスワード欄に `admin123` を入力
4. 「ログイン」ボタンをクリック

**期待結果**:
- ✅ チャット画面（http://localhost:3247/）にリダイレクトされる
- ✅ 認証済み状態になる（ヘッダーにユーザー情報が表示される）
- ✅ エラーメッセージが表示されない

---

### E2E-LOGIN-003: 一般ユーザーアカウントでログイン

**目的**: 一般ユーザーアカウントでログインし、チャット画面にアクセスできることを確認

**操作手順**:
1. http://localhost:3247/login にアクセス
2. メールアドレス欄に `demo@example.com` を入力
3. パスワード欄に `demo123` を入力
4. 「ログイン」ボタンをクリック

**期待結果**:
- ✅ チャット画面（http://localhost:3247/）にリダイレクトされる
- ✅ 認証済み状態になる（ヘッダーにユーザー情報が表示される）
- ✅ エラーメッセージが表示されない

---

### E2E-LOGIN-004: 誤った認証情報でログイン試行

**目的**: 認証失敗時にエラーメッセージが表示されることを確認

**操作手順**:
1. http://localhost:3247/login にアクセス
2. メールアドレス欄に `invalid@example.com` を入力
3. パスワード欄に `wrongpassword` を入力
4. 「ログイン」ボタンをクリック

**期待結果**:
- ✅ エラーメッセージ（Alert）が表示される
- ✅ ログインページに留まる（リダイレクトされない）
- ✅ 入力した内容がクリアされずに残る

---

### E2E-LOGIN-005: ログイン中の状態表示

**目的**: ログイン処理中にボタンが無効化され、ユーザーに処理中であることが伝わることを確認

**操作手順**:
1. http://localhost:3247/login にアクセス
2. メールアドレス欄に `admin@example.com` を入力
3. パスワード欄に `admin123` を入力
4. 「ログイン」ボタンをクリック
5. ボタンの状態を確認

**期待結果**:
- ✅ ボタンが無効化される（disabled状態）
- ✅ ボタンテキストが「ログイン中...」に変わる
- ✅ 処理完了後、チャット画面にリダイレクトされる

---

## 品質チェックリスト

| 確認項目 | チェック |
|---------|---------|
| 要件定義（docs/requirements.md セクション3.1）を確認したか？ | ✅ |
| UI実装（frontend/src/pages/LoginPage.tsx）を確認したか？ | ✅ |
| ユーザーゴールを明確化したか？ | ✅ |
| フロー単位で設計したか？ | ✅ |
| E2E項目数が5-10項目以内か？ | ✅（5項目） |
| 認証/バリデーション/エラー系を除外したか？ | ✅（認証エラーはユーザーゴール達成のため最小限含める） |

---

## 除外項目（E2Eテストで実施しない）

以下は将来のユニット/統合テストでカバー予定のため、E2Eテストには含めません。

| 除外項目 | 理由 | カバー先 |
|---------|------|---------|
| ❌ メール形式バリデーション | ユニットテストでカバー予定 | `tests/unit/schemas/` |
| ❌ パスワード8文字以上バリデーション | ユニットテストでカバー予定 | `tests/unit/schemas/` |
| ❌ 401エラーの詳細 | 内部結合テストでカバー予定 | `tests/integration/internal/` |
| ❌ セッション管理詳細 | 内部結合テストでカバー予定 | `tests/integration/internal/` |
| ❌ レスポンシブ表示 | E2Eの範囲外 | 目視確認 |
| ❌ Okta SSO機能 | 現時点で無効化（要件外） | 将来実装時に追加 |

---

## 注意事項

- **実認証必須**: このE2Eテストでは実際のバックエンドAPIに対してログイン認証を行います。モック禁止。
- **テストアカウント**: admin@example.com と demo@example.com が事前にDBに登録されていることが前提です。
- **環境変数**: `.env.local` が正しく設定され、バックエンドAPIが起動していることを確認してください。
- **テスト実行順序**: E2E-LOGIN-001 → E2E-LOGIN-002/003/004/005 の順で実行することを推奨します。
