# E2Eテスト仕様書: マルチテナントSaaS化 + セルフサービストライアル

## テストケース一覧（5項目）
| ID | シナリオ | フロー内容 | 期待結果 |
|----|---------|-----------|---------|
| E2E-MT-001 | セルフサービス登録→即利用 | LP→サインアップ→企業名+メール+PW入力→送信 | チャット画面に遷移、認証済み状態 |
| E2E-MT-002 | 新規テナントでのチャット送信 | サインアップ後→質問送信 | AI回答が返る（ナレッジ0件のため「情報がありません」系回答） |
| E2E-MT-003 | 新規テナントの管理画面 | サインアップ後→管理ダッシュボード | 統計0件、ドキュメント0件、ユーザー1件（自分） |
| E2E-MT-004 | トライアル期限切れ→ログイン不可 | 期限切れアカウントでログイン試行 | 「トライアル期限が切れました」メッセージ表示 |
| E2E-MT-005 | 既存テナントリグレッション確認 | 既存アカウント（admin@example.com）でログイン→チャット→管理画面 | 既存データが正常に表示・操作可能 |

## 詳細シナリオ

### E2E-MT-001: セルフサービス登録→即利用フロー
**前提条件**: 未ログイン状態
**操作手順**:
1. LPページ（/）にアクセス
2. 「無料で試す」ボタンをクリック
3. /signup ページに遷移を確認
4. 企業名「テスト株式会社」、メール「e2e-mt-test@example.com」、パスワード「TestPass123!」を入力
5. 「アカウントを作成」ボタンをクリック
6. チャット画面（/）に遷移を確認
**期待結果**:
- チャット画面が表示される
- 入力欄と送信ボタンが表示される
- ヘッダーにユーザー名またはメールが表示される
**検証ポイント**:
- 登録→即利用のシームレスな体験
- JWTが発行されlocalStorageに保存される

### E2E-MT-002: 新規テナントでのチャット送信
**前提条件**: E2E-MT-001で作成したアカウントでログイン済み
**操作手順**:
1. チャット入力欄に「就業規則について教えてください」と入力
2. 送信ボタンをクリック
3. AI回答の表示を待つ
**期待結果**:
- AI回答が表示される（ナレッジ0件のためガードレール回答）
- エラーにならず正常に動作する
- 他テナント（巴商会）のドキュメントが参照されない
**検証ポイント**:
- テナント分離が正しく動作している
- 空ナレッジ状態でもクラッシュしない

### E2E-MT-003: 新規テナントの管理画面アクセス
**前提条件**: E2E-MT-001で作成したアカウント（role=admin）でログイン済み
**操作手順**:
1. サイドバーから「ダッシュボード」に遷移
2. 統計カードの値を確認
3. 「ナレッジ管理」に遷移
4. ドキュメント一覧を確認
5. 「ユーザー管理」に遷移
6. ユーザー一覧を確認
**期待結果**:
- ダッシュボード: 全統計が0
- ナレッジ管理: ドキュメント0件
- ユーザー管理: 自分のみ1件表示
**検証ポイント**:
- テナント初期状態が正しい
- 他テナントのデータが表示されない

### E2E-MT-004: トライアル期限切れ→ログイン不可
**前提条件**: トライアル期限切れのアカウントが存在する（テスト前にDBで期限を過去に設定）
**操作手順**:
1. /login にアクセス
2. 期限切れアカウントのメール・パスワードを入力
3. 「ログイン」ボタンをクリック
**期待結果**:
- ログインページに留まる
- 「トライアル期限が切れました。プランのアップグレードについてはお問い合わせください。」メッセージが表示される
**検証ポイント**:
- トライアル期限チェックが正しく動作
- 期限切れユーザーがシステムにアクセスできない

### E2E-MT-005: 既存テナント（巴商会）リグレッション確認
**前提条件**: マルチテナント移行後の既存アカウント
**操作手順**:
1. /login にアクセス
2. admin@example.com / admin123 でログイン
3. チャット画面で質問送信
4. AI回答と参照元の表示を確認
5. 管理ダッシュボードで統計確認
6. ナレッジ管理でドキュメント一覧確認
**期待結果**:
- 既存の全機能が正常動作
- 既存ドキュメントが表示される
- 統計データが正しく表示される
**検証ポイント**:
- マルチテナント移行による既存機能への影響なし
- 既存データの移行が正しく完了している
