# 質問履歴画面 E2Eテスト仕様書

生成日: 2026-02-06
対象ページ: `/history` (P-002)
権限レベル: member+

---

## ユーザーゴール

1. 過去の質問と回答を確認できる
2. 特定の質問を検索して見つけることができる
3. 評価別に質問を絞り込むことができる
4. 質問・回答の詳細を確認できる

---

## テスト環境

```yaml
URL: http://localhost:3247/history
認証: 必須（ProtectedRoute）
テストアカウント:
  email: demo@example.com
  password: demo123
```

---

## E2Eテスト項目一覧（5項目）

| ID | テスト項目 | フロー内容 | 期待結果 |
|----|----------|-----------|---------|
| E2E-HIST-001 | ページアクセス・一覧表示 | ログイン → /history → テーブル表示 | 質問履歴が一覧表示される |
| E2E-HIST-002 | キーワード検索フロー | 検索欄に入力 → 結果絞り込み → クリア | 該当質問のみ表示される |
| E2E-HIST-003 | フィードバックフィルターフロー | フィルター選択（Good/Bad/未評価） → 結果絞り込み | 該当評価の質問のみ表示される |
| E2E-HIST-004 | 詳細表示フロー | 詳細ボタン → モーダル表示 → 閉じる | 質問・回答の全文が表示される |
| E2E-HIST-005 | ページネーションフロー | 次ページボタン → ページ移動 → 表示件数変更 | 正しくページが切り替わる |

---

## E2E-HIST-001: ページアクセス・一覧表示

### 目的
ログイン後に質問履歴ページにアクセスし、過去の質問一覧が正しく表示されることを確認する。

### 前提条件
- ユーザーがログインしている
- 過去に質問履歴が1件以上存在する

### テストステップ
1. サイドバーから「質問履歴」をクリック
2. /history ページに遷移
3. テーブルが表示される

### 期待結果
- ✅ URLが `/history` になる
- ✅ ヘッダーに「質問履歴」が表示される
- ✅ テーブルに以下のカラムが表示される
  - 日時
  - 質問
  - 回答（抜粋）
  - 類似度
  - 評価
  - 詳細
- ✅ 質問履歴が1件以上表示される
- ✅ 各行に日時、質問文、回答抜粋が表示される

---

## E2E-HIST-002: キーワード検索フロー

### 目的
検索欄にキーワードを入力して、該当する質問のみが絞り込まれることを確認する。

### 前提条件
- /history ページが表示されている
- 質問履歴が複数件存在する

### テストステップ
1. 検索欄に特定のキーワード（例: "営業"）を入力
2. リアルタイムで絞り込み結果が表示される
3. 検索欄をクリアする

### 期待結果
- ✅ キーワード入力後、該当する質問のみが表示される
- ✅ 該当しない質問は非表示になる
- ✅ 検索欄をクリアすると全件表示に戻る
- ✅ "質問"または"回答"にキーワードが含まれるものが抽出される

---

## E2E-HIST-003: フィードバックフィルターフロー

### 目的
フィードバックフィルター（Good/Bad/未評価/すべて）で質問を絞り込めることを確認する。

### 前提条件
- /history ページが表示されている
- 各フィードバックタイプの質問が最低1件ずつ存在する

### テストステップ
1. フィードバックフィルターで「Good」を選択
2. Good評価の質問のみが表示される
3. フィードバックフィルターで「Bad」を選択
4. Bad評価の質問のみが表示される
5. フィードバックフィルターで「未評価」を選択
6. 未評価の質問のみが表示される
7. フィードバックフィルターで「すべて」を選択
8. 全質問が表示される

### 期待結果
- ✅ 各フィルター選択後、該当する評価の質問のみが表示される
- ✅ 「Good」選択時: Goodチップ付きの質問のみ表示
- ✅ 「Bad」選択時: Badチップ付きの質問のみ表示
- ✅ 「未評価」選択時: 未評価チップ付きの質問のみ表示
- ✅ 「すべて」選択時: 全質問が表示される
- ✅ フィルター変更時にページが0にリセットされる

---

## E2E-HIST-004: 詳細表示フロー

### 目的
質問の詳細ボタンをクリックして、質問・回答の全文がモーダルで表示されることを確認する。

### 前提条件
- /history ページが表示されている
- 質問履歴が1件以上表示されている

### テストステップ
1. 任意の質問の「詳細」ボタン（目のアイコン）をクリック
2. モーダルが表示される
3. 質問・回答の全文を確認
4. 「閉じる」ボタンをクリック
5. モーダルが閉じる

### 期待結果
- ✅ モーダルのタイトルが「質問・回答の詳細」と表示される
- ✅ モーダルに日時が表示される
- ✅ 質問セクションに質問の全文が表示される
- ✅ 回答セクションに回答の全文が表示される
- ✅ 類似度チップが表示される
- ✅ フィードバックチップが表示される
- ✅ 「回答なし」の場合は「回答不可」チップが表示される
- ✅ 「閉じる」ボタンでモーダルが閉じる
- ✅ モーダル外クリックでも閉じる

---

## E2E-HIST-005: ページネーションフロー

### 目的
ページネーション機能が正しく動作し、表示件数変更も可能なことを確認する。

### 前提条件
- /history ページが表示されている
- 質問履歴が11件以上存在する（デフォルト10件/ページ）

### テストステップ
1. テーブル下部のページネーションで「次のページ」をクリック
2. 2ページ目の質問が表示される
3. 表示件数を「25」に変更
4. 25件まで表示される

### 期待結果
- ✅ 初期表示時に10件が表示される
- ✅ 「次のページ」クリック後、11件目以降が表示される
- ✅ ページ番号が正しく更新される（1→2）
- ✅ 表示件数を「25」に変更後、25件まで表示される
- ✅ ページがリセットされる（2ページ目→1ページ目）
- ✅ 総件数が正しく表示される（例: "1-10 / 25"）
- ✅ 「前のページ」ボタンで戻れる

---

## 品質チェックリスト

| 確認項目 | チェック |
|---------|---------|
| 要件定義（docs/requirements.md）を確認したか？ | ✅ |
| UI実装を確認したか？ | ✅ |
| ユーザーゴールを明確化したか？ | ✅ |
| フロー単位で設計したか？ | ✅ |
| E2E項目数が5-10項目以内か？ | ✅ (5項目) |
| 認証/バリデーション/エラー系を除外したか？ | ✅ |

---

## 除外事項（統合テストでカバー予定）

以下の項目はE2Eテストの範囲外とし、内部統合テストでカバーします。

- ❌ 認証エラー（401）
- ❌ 権限エラー（403）
- ❌ APIエラー（500）
- ❌ ネットワークエラー
- ❌ レスポンシブ表示
- ❌ アクセシビリティ
