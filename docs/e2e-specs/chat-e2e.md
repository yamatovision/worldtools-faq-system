# チャット画面 E2Eテスト仕様書

生成日: 2026-02-06
対象ページ: `/` (P-001: チャット画面)
権限レベル: member+

---

## ユーザーゴール

1. AIに質問して即座に回答を得る
2. 回答の参照元ドキュメントを確認できる
3. 回答の役立ち度を評価できる
4. 高精度モード（Agentic RAG）を使い分けられる

---

## テスト環境

```yaml
URL: http://localhost:3247/
認証: 必須（ProtectedRoute）
テストアカウント:
  email: demo@example.com
  password: demo123
バックエンド: http://localhost:8432
```

---

## E2Eテスト項目一覧（7項目）

| ID | テスト項目 | フロー内容 | 期待結果 |
|----|----------|-----------|---------|
| E2E-CHAT-001 | 初回アクセス | ログイン → / → 初期画面表示 | 空のチャット画面、入力欄、送信ボタンが表示される |
| E2E-CHAT-002 | 標準モード質問送信 | 高精度モードOFF → 質問入力 → 送信 → 回答取得 | AI回答と参照元ドキュメントが表示される |
| E2E-CHAT-003 | 高精度モード質問送信 | 高精度モードON → 質問入力 → 送信 → 回答取得 | ステッパー表示後、AI回答と参照元が表示される |
| E2E-CHAT-004 | 回答フィードバック（良） | 回答取得後 → Thumbs Upクリック | アイコンがハイライト表示される |
| E2E-CHAT-005 | 回答フィードバック（悪） | 回答取得後 → Thumbs Downクリック | アイコンがハイライト表示される |
| E2E-CHAT-006 | 連続質問（会話履歴） | 質問1送信 → 回答取得 → 質問2送信 → 回答取得 | 過去の会話が画面に保持され、スクロール可能 |
| E2E-CHAT-007 | 空欄送信不可 | 空欄で送信ボタンクリック | 送信ボタンが無効化されており何も起こらない |

---

## テスト詳細

### E2E-CHAT-001: 初回アクセス

**前提条件**:
- demo@example.com でログイン済み

**操作手順**:
1. `/` にアクセス

**期待結果**:
- ページタイトル「AIに質問する」が表示される
- 「社内マニュアル・規定に基づいて回答します」のサブタイトルが表示される
- 「質問を入力してください」の初期メッセージが表示される
- 質問入力欄とボタンが表示される
- 高精度モードのトグルスイッチが表示される

---

### E2E-CHAT-002: 標準モード質問送信

**前提条件**:
- E2E-CHAT-001完了
- 高精度モードがOFF

**操作手順**:
1. 高精度モードがOFFであることを確認
2. 質問入力欄に「有給休暇の残日数の確認方法は？」と入力
3. 送信ボタンをクリック

**期待結果**:
- 質問が画面右側に表示される
- ローディング表示（CircularProgress）が一瞬表示される
- AI回答が画面左側にストリーミングで表示される
- 参照元ドキュメントが回答下部にChipで表示される
- 類似度（%）が表示される
- フィードバックボタン（Thumbs Up/Down）が表示される

---

### E2E-CHAT-003: 高精度モード質問送信

**前提条件**:
- E2E-CHAT-001完了

**操作手順**:
1. 高精度モードトグルをONに切り替え
2. 質問入力欄に「経費精算の締め日はいつですか？」と入力
3. 送信ボタンをクリック

**期待結果**:
- 質問が画面右側に表示される
- Agenticフローのステッパーが表示される（質問分類 → 質問分析 → 情報検索 → ...）
- 各ステップが順次完了していく
- AI回答が画面左側にストリーミングで表示される
- 参照元ドキュメントが回答下部にChipで表示される
- 類似度（%）が表示される
- フィードバックボタン（Thumbs Up/Down）が表示される

---

### E2E-CHAT-004: 回答フィードバック（良）

**前提条件**:
- E2E-CHAT-002完了（AI回答が表示されている状態）

**操作手順**:
1. AI回答下部のThumb Upボタンをクリック

**期待結果**:
- Thumb Upアイコンが緑色（success）にハイライトされる
- Thumb Downアイコンは通常色のまま

---

### E2E-CHAT-005: 回答フィードバック（悪）

**前提条件**:
- E2E-CHAT-002完了（AI回答が表示されている状態）

**操作手順**:
1. AI回答下部のThumb Downボタンをクリック

**期待結果**:
- Thumb Downアイコンが赤色（error）にハイライトされる
- Thumb Upアイコンは通常色のまま

---

### E2E-CHAT-006: 連続質問（会話履歴）

**前提条件**:
- E2E-CHAT-002完了（1つ目の回答が表示されている状態）

**操作手順**:
1. 質問入力欄に「その残日数はどこで確認できますか？」と入力
2. 送信ボタンをクリック

**期待結果**:
- 1つ目の質問と回答がそのまま画面に残る
- 2つ目の質問が画面右側に追加される
- AI回答が画面左側にストリーミングで表示される
- 会話履歴全体がスクロール可能
- 最新の回答まで自動スクロールされる

---

### E2E-CHAT-007: 空欄送信不可

**前提条件**:
- E2E-CHAT-001完了

**操作手順**:
1. 質問入力欄を空欄のままにする
2. 送信ボタンを確認する

**期待結果**:
- 送信ボタンが無効化（disabled）されている
- クリックしても何も起こらない

---

## 対象外項目（別テスト仕様書でカバー）

| 項目 | カバー先 |
|------|---------|
| GraphRAG検索精度 | graphrag-agentic-e2e.md |
| Agentic RAG複雑フロー | graphrag-agentic-e2e.md |
| ログインエラー（401） | 内部結合テスト |
| バリデーションエラー（400） | ユニットテスト |
| タイムアウトエラー | 内部結合テスト |

---

## 品質チェックリスト

| 確認項目 | チェック |
|---------|---------|
| 要件定義（docs/requirements.md）を確認したか？ | ✅ |
| UI実装（ChatPage.tsx）を確認したか？ | ✅ |
| ユーザーゴールを明確化したか？ | ✅ |
| フロー単位で設計したか？ | ✅ |
| E2E項目数が5-10項目以内か？ | ✅（7項目） |
| 認証/バリデーション/エラー系を除外したか？ | ✅ |
| GraphRAG/Agentic RAGの高度なテストを除外したか？ | ✅ |

---

## 備考

- GraphRAG/Agentic RAGの詳細なテストは `graphrag-agentic-e2e.md` に記載済み
- 本仕様書は基本的なチャット機能のUIフローのみをカバー
- 実認証を使用し、モック禁止
