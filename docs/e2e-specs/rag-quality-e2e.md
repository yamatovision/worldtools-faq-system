# E2Eテスト仕様書: RAGデータ品質改善

## テストケース一覧（5項目）

| ID | シナリオ | フロー内容 | 期待結果 |
|----|---------|-----------|---------|
| E2E-RQ-001 | PDFアップロード→構造化Markdown確認 | ログイン→管理画面→ドキュメント管理→図表含むPDFアップロード | 構造化テキストとしてチャンク化、GraphRAG構築完了 |
| E2E-RQ-002 | Excelアップロード→Markdown変換確認 | ログイン→管理画面→ドキュメント管理→Excelアップロード | テーブル構造保持Markdownとしてチャンク化 |
| E2E-RQ-003 | Wordアップロード→Claude処理確認 | ログイン→管理画面→ドキュメント管理→docxアップロード | 表・画像含むdocxが構造化テキストとしてチャンク化 |
| E2E-RQ-004 | 100ページ超PDF分割処理確認 | 大容量PDFアップロード→バックエンドログ確認 | 分割処理→各バッチ処理→結合が正常完了 |
| E2E-RQ-005 | GraphRAGパイプライン正常動作確認 | 新方式ドキュメント→チャット質問 | graph_build_status=completed、質問に回答可能 |

---

## 詳細シナリオ

### E2E-RQ-001: PDFアップロード→構造化Markdown確認
**前提条件**: 管理者アカウントでログイン済み。図表を含むサンプルPDFを用意。
**操作手順**:
1. 管理画面 → ドキュメント管理ページにアクセス
2. 「アップロード」ボタンをクリック
3. 図表を含むPDFファイルを選択
4. 公開設定を選択してアップロード
5. ドキュメント一覧に追加されることを確認
6. ステータスが「completed」になるまで待機
**期待結果**:
- ドキュメントがcompleted状態で一覧に表示
- チャンク数が適切に生成されている
- GraphRAG構築ステータスがcompletedになる
**検証ポイント**:
- ステータス遷移: importing → completed
- チャンク数 > 0
- graph_build_status = completed

### E2E-RQ-002: Excelアップロード→Markdown変換確認
**前提条件**: 管理者アカウントでログイン済み。複数シートのExcelファイルを用意。
**操作手順**:
1. 管理画面 → ドキュメント管理ページにアクセス
2. 「アップロード」ボタンをクリック
3. .xlsxファイルを選択（ドラッグ&ドロップまたはファイル選択）
4. アップロード実行
5. 一覧に追加されることを確認
**期待結果**:
- .xlsxファイルがアップロード可能（バリデーション通過）
- ドキュメントがcompleted状態で表示
- チャンク数が適切（テーブル構造がMarkdownとして保持）
**検証ポイント**:
- フロントエンドで.xlsxファイルがバリデーション通過
- ステータス: completed
- チャンク数 > 0

### E2E-RQ-003: Wordアップロード→Claude処理確認
**前提条件**: 管理者アカウントでログイン済み。表・画像を含むdocxファイルを用意。
**操作手順**:
1. 管理画面 → ドキュメント管理ページにアクセス
2. .docxファイルをアップロード
3. completed状態まで待機
**期待結果**:
- Claude APIによる高品質テキスト抽出
- 表構造がMarkdown形式で保持
- チャンク数が従来方式より適切
**検証ポイント**:
- ステータス: completed
- チャンク数 > 0

### E2E-RQ-004: 100ページ超PDF分割処理確認
**前提条件**: 管理者アカウントでログイン済み。100ページ超のPDFを用意。
**操作手順**:
1. 100ページ超のPDFをアップロード
2. バックエンドのログで分割処理を確認
3. completed状態まで待機
**期待結果**:
- PDFが100ページ単位に分割処理される
- 各バッチのClaude API呼び出しが成功
- 全バッチの結果が結合されてチャンク化
**検証ポイント**:
- ステータス: completed（エラーなし）
- バックエンドログに分割処理の記録
- チャンク数がページ数に比例

### E2E-RQ-005: GraphRAGパイプライン正常動作確認
**前提条件**: E2E-RQ-001〜003のドキュメントがアップロード済み。
**操作手順**:
1. チャット画面にアクセス
2. アップロードしたドキュメントに関する質問を送信
3. 回答と参照元を確認
**期待結果**:
- アップロードしたドキュメントの内容に基づいた回答が生成
- 参照元ドキュメントが表示
- GraphRAGエンティティが正常に構築されている
**検証ポイント**:
- 回答内容がドキュメントの構造化情報を反映
- 参照元にアップロードしたドキュメントが含まれる
