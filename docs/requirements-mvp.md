# 巴商会 社内AI FAQシステム - 要件定義書（MVP版）

> **MVP版について**
> - 巴商会様への提案用に作成した実動作版
> - 2ページ構成で核心機能を体験可能
> - 正式発注後、Okta連携・BOX連携等に拡張可能

---

## 1. プロジェクト概要

### 1.1 成果目標

人事・経理基幹システムの問い合わせに24時間AIが自動回答し、営業時間外や担当者不在時も現場が業務を止めずに進められる社内FAQシステムを構築する。

### 1.2 MVP版で体験できること

- ✅ AIに質問して、マニュアル・規定に基づいた回答を得る
- ✅ 参照元ドキュメントの表示
- ✅ 「わからない場合は事務局へ」のガードレール
- ✅ ドキュメントのアップロード・管理
- ✅ 実際に動作するシステム（URLでアクセス可能）

---

## 2. MVP版システム構成

### 2.1 ページ構成（2ページ）

| ID | ページ名 | 目的 |
|----|---------|------|
| **P-001** | チャット画面 | AIに質問して回答を得る（メイン機能） |
| **A-001** | 管理画面 | ドキュメントのアップロード・管理 |

### 2.2 技術スタック（MVP版）

```yaml
フロントエンド:
  - React 18 + TypeScript 5
  - MUI v6（UIコンポーネント）
  - Vite 5（ビルドツール）

バックエンド:
  - Python 3.12 + FastAPI
  - LangChain（RAGパイプライン）

AI:
  - OpenAI API（GPT-4o、text-embedding-3-small）

データベース:
  - PostgreSQL（Neon）+ pgvector

インフラ:
  - フロントエンド: Vercel
  - バックエンド: Google Cloud Run
```

### 2.3 MVP版の簡略化ポイント

| 項目 | フル版 | MVP版 |
|------|--------|-------|
| 認証 | Okta SSO | シンプルなパスワード認証 |
| ドキュメント取込 | BOX API連携 | ファイルアップロード |
| 部門別アクセス制御 | あり | なし（全ドキュメント参照可） |
| 利用統計 | あり | なし |
| 回答品質管理 | あり | なし |

---

## 3. ページ詳細仕様

### 3.1 P-001: チャット画面

#### 目的
社員がAIに質問し、マニュアル・規定に基づいた回答を即座に得る。

#### 画面構成
```
┌─────────────────────────────────────────┐
│  巴商会 社内FAQ AI                    [管理] │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 🤖 こんにちは！                    │   │
│  │    人事・経理に関するご質問に      │   │
│  │    お答えします。                  │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 👤 経費精算の申請方法を教えて     │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 🤖 経費精算の申請方法について     │   │
│  │    ご説明します。                  │   │
│  │                                   │   │
│  │    1. システムにログイン          │   │
│  │    2. 「経費精算」メニューを選択  │   │
│  │    ...                            │   │
│  │                                   │   │
│  │    📎 参照: 経費精算マニュアル.pdf │   │
│  │                                   │   │
│  │    👍 役に立った  👎 役に立たなかった │   │
│  └─────────────────────────────────┘   │
│                                         │
├─────────────────────────────────────────┤
│  [質問を入力してください...]        [送信] │
└─────────────────────────────────────────┘
```

#### 主要機能
- テキスト入力による質問送信
- AIによる回答表示（ストリーミング対応）
- 参照元ドキュメントの表示
- 回答へのフィードバック（役に立った/立たなかった）
- 確信度が低い場合「事務局にお問い合わせください」を表示

#### API

| メソッド | エンドポイント | 用途 |
|---------|---------------|------|
| POST | `/api/chat` | 質問を送信し回答を取得 |
| POST | `/api/feedback` | フィードバックを送信 |

---

### 3.2 A-001: 管理画面

#### 目的
マニュアル・規定ドキュメントをアップロードし、AIが参照できるようにする。

#### 画面構成
```
┌─────────────────────────────────────────┐
│  巴商会 社内FAQ AI - 管理画面        [戻る] │
├─────────────────────────────────────────┤
│                                         │
│  ドキュメント管理                        │
│  ─────────────────────────────────────  │
│                                         │
│  [ファイルをアップロード]                │
│  対応形式: PDF, Word (.docx)            │
│                                         │
│  ─────────────────────────────────────  │
│  登録済みドキュメント                    │
│  ─────────────────────────────────────  │
│                                         │
│  📄 経費精算マニュアル.pdf              │
│     登録日: 2026-01-20  [削除]          │
│                                         │
│  📄 育児休業規定.pdf                    │
│     登録日: 2026-01-20  [削除]          │
│                                         │
│  📄 勤怠システム操作手順.docx           │
│     登録日: 2026-01-20  [削除]          │
│                                         │
└─────────────────────────────────────────┘
```

#### 主要機能
- ファイルアップロード（PDF, Word対応）
- 登録済みドキュメント一覧表示
- ドキュメント削除
- アップロード時の自動ベクトル化

#### API

| メソッド | エンドポイント | 用途 |
|---------|---------------|------|
| GET | `/api/documents` | ドキュメント一覧取得 |
| POST | `/api/documents/upload` | ドキュメントアップロード |
| DELETE | `/api/documents/{id}` | ドキュメント削除 |

---

## 4. データ設計

### 4.1 エンティティ（MVP版）

```yaml
Document（ドキュメント）:
  - id: UUID
  - filename: ファイル名
  - file_type: pdf / docx
  - created_at: 登録日時

DocumentChunk（ドキュメントチャンク）:
  - id: UUID
  - document_id: 親ドキュメントID
  - content: テキスト内容
  - embedding: ベクトル（1536次元）
  - chunk_index: チャンク番号

ChatHistory（チャット履歴）:
  - id: UUID
  - question: 質問テキスト
  - answer: 回答テキスト
  - referenced_docs: 参照ドキュメントID一覧
  - feedback: good / bad / null
  - created_at: 日時
```

---

## 5. 処理フロー

### 5.1 質問→回答生成フロー

```
1. ユーザーが質問を入力
2. 質問テキストをベクトル化（OpenAI Embedding）
3. ベクトルDBで類似チャンクを検索（上位5件）
4. 検索結果をコンテキストとしてGPT-4oに送信
5. 回答を生成（ストリーミング）
6. 参照元ドキュメント情報を付与
7. 確信度が低い場合はガードレール表示
```

### 5.2 ドキュメントアップロードフロー

```
1. ユーザーがファイルをアップロード
2. ファイル形式を判定（PDF/Word）
3. テキスト抽出
4. チャンクに分割（500トークン、50オーバーラップ）
5. 各チャンクをベクトル化
6. DBに保存
7. 完了通知
```

---

## 6. 正式版への拡張ポイント

MVP版から正式版への拡張時に対応する項目：

| 機能 | 対応内容 |
|------|---------|
| **Okta SSO連携** | 認証をOkta OIDCに差し替え |
| **BOX連携** | ファイルアップロードをBOX API連携に変更 |
| **部門別アクセス制御** | ドキュメントに部門制限を追加 |
| **利用統計** | 質問数推移、よくある質問等の統計画面追加 |
| **回答品質管理** | 低評価回答の確認、改善メモ機能追加 |
| **質問履歴** | ユーザー別の質問履歴画面追加 |

---

## 7. デプロイ情報

```yaml
フロントエンド:
  URL: https://tomoe-faq.vercel.app（予定）
  プラットフォーム: Vercel

バックエンド:
  URL: https://tomoe-faq-api-xxxxx.run.app（予定）
  プラットフォーム: Google Cloud Run
  リージョン: asia-northeast1（東京）

データベース:
  プラットフォーム: Neon
  リージョン: Asia（Singapore）
```

---

## 改訂履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2026-01-20 | 1.0 | MVP版作成 |
